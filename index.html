<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Enviar / Compartir Contrato</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 24px; background:#f9f9f9; }
    h1 { color:#333; }
    form { max-width: 600px; margin-top:20px; background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,.1); }
    label { display:block; margin: 12px 0 6px; font-weight:600; }
    input, select, button { width:100%; padding:10px; font-size:16px; }
    button { margin-top:16px; cursor:pointer; background:#0069d9; color:#fff; border:none; border-radius:6px; }
    button:disabled { background:#999; }
    pre { background:#222; color:#0f0; padding:12px; border-radius:6px; overflow-x:auto; }
    .card { border:1px solid #ddd; border-radius:10px; padding:16px; margin-top:16px; background:#fff; }
    .ok { color:#0a7a2f; font-weight:bold; }
    .err { color:#b00020; font-weight:bold; }
  </style>
</head>
<body>
  <h1>Enviar / Compartir Contrato</h1>
  <p>Ingresá el <b>link de Drive</b> (o ID del archivo) y el <b>email del cliente</b>. Elegí si querés <i>compartir</i>, <i>enviar por mail</i> o <i>ambas</i>.</p>

  <form id="form">
    <label for="fileUrl">Link de Drive (o ID)</label>
    <input id="fileUrl" name="fileUrl" type="text" required placeholder="https://drive.google.com/file/d/XXXXX/view" />

    <label for="email">Email del cliente</label>
    <input id="email" name="email" type="email" required placeholder="cliente@empresa.com" />

    <label for="mode">Acción</label>
    <select id="mode" name="mode">
      <option value="share">Compartir en Drive</option>
      <option value="send">Enviar por email (adjunto PDF)</option>
      <option value="both" selected>Ambas</option>
    </select>

    <button id="submitBtn" type="submit">Ejecutar</button>
  </form>

  <div id="result" class="card" style="display:none;"></div>

  <script>
    const GAS_URL = "https://script.google.com/a/macros/runmedia.co/s/AKfycbxHrA1NDNDaVUKAgIB_wLBr4SHhRzAwj-QjwAjgjIjogx_Iqu6UQvUpnHBM3UjCws4Q/exec";

    const form = document.getElementById("form");
    const result = document.getElementById("result");
    const submitBtn = document.getElementById("submitBtn");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      result.style.display = "none";
      submitBtn.disabled = true;
      submitBtn.textContent = "Procesando...";

      try {
        const fileUrl = document.getElementById("fileUrl").value.trim();
        const email   = document.getElementById("email").value.trim();
        const mode    = document.getElementById("mode").value;

        const body = new URLSearchParams();
        body.set("fileUrl", fileUrl);
        body.set("email", email);
        body.set("mode", mode);

        const resp = await fetch(GAS_URL, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body
        });

        const data = await resp.json().catch(() => ({}));

        result.style.display = "block";
        if (data.ok) {
          const acts = (data.actions || []).map(a => `${a.action}: ${a.status}`).join(" | ");
          result.innerHTML = `
            <div class="ok">✅ Operación realizada con éxito</div>
            <div><b>File ID:</b> ${data.fileId || "-"}</div>
            <div><b>Acciones:</b> ${acts || "-"}</div>
          `;
        } else {
          result.innerHTML = `
            <div class="err">❌ Error</div>
            <div>${(data && (data.error || JSON.stringify(data))) || "Error desconocido"}</div>
          `;
        }
      } catch (err) {
        result.style.display = "block";
        result.innerHTML = `
          <div class="err">❌ Error de red o CORS</div>
          <div>${(err && err.message) || err}</div>
        `;
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Ejecutar";
      }
    });
  </script>
</body>
</html>
